<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">


    <title> - 空白页</title>
    <meta content="" name="keywords">
    <meta content="" name="description">

    <link href="favicon.ico" rel="shortcut icon">
    <link href="{{contentPath}}/resource/css/bootstrap.min.css?v=3.3.6" rel="stylesheet">
    <link href="{{contentPath}}/resource/css/font-awesome.css?v=4.4.0" rel="stylesheet">
    <link href="{{contentPath}}/resource/styles/github.css" rel="stylesheet">
    <link href="{{contentPath}}/resource/js/plugins/steps/jquery.steps.css" rel="stylesheet">
    <link href="{{contentPath}}/resource/js/plugins/iCheck/custom.css" rel="stylesheet">
    <link href="{{contentPath}}/resource/js/plugins/toastr/toastr.min.css" rel="stylesheet">
    <link href="{{contentPath}}/resource/bootstrap.min.css" rel="stylesheet"/>
    <link href="{{contentPath}}/resource/css/animate.css" rel="stylesheet">
    <link href="{{contentPath}}/resource/css/style.css?v=4.1.0" rel="stylesheet">
    <link href="{{contentPath}}/resource/css/animate.css" rel="stylesheet">
    <link href="{{contentPath}}/resource/css/style.css?v=4.1.0" rel="stylesheet">
    <link href="{{contentPath}}/resource/js/plugins/bootstrap-table/bootstrap-table.min.css" rel="stylesheet"/>

    <style>
        #tools {
            position: fixed;
            top: 50px;
            right: 0;
        }

        .hljs .hljs-keyword:first-child {
            margin-left: -197px;
        }

        .hljs .hljs-attr:first-child {
            margin-left: -197px;
        }

        .custom-tooltip-title {
            margin: 0px 12px;
            padding: 72px 0 8px;
            font-size: 12px;
            border-bottom-style: solid;
            border-bottom-width: thin;
            border-bottom-color: #e9e9e9;
        }

        .custom-tooltip-value {
            display: grid;
            grid-template-columns: 1fr 1fr;
            margin: 8px 12px 0 12px;
            padding-bottom: 8px;
            /*font-size: 40px;*/
            text-align: center;
            border-bottom-style: solid;
            border-bottom-width: thin;
            border-bottom-color: #e9e9e9;
            height: 70px;
        }

        .g2-tooltip {
            width: 200px;
        }

        .custom-tooltip-temp {
            display: flex;
            position: relative;
            align-items: center;
        }

        .custom-tooltip-temp span:first-child {
            font-size: 12px;
            position: absolute;
            top: 0px;
            color: rgba(0, 0, 0, 0.45)
        }

        .custom-tooltip-temp span:last-child {
            text-align: left;
            margin-top: 10px;
            position: relative;
            color: rgba(0, 0, 0, 0.85)
        }

        .custom-tooltip-wind {
            margin: 8px 12px 12px 12px;
            font-size: 10px;
            color: rgba(0, 0, 0, 0.45);
            display: grid;
            grid-template-columns: 1fr 1fr;
        }

        .tooltip-footer {
            margin: 8px 12px 12px 12px;
            font-size: 10px;
            color: rgba(0, 0, 0, 0.45);
        }

        .background-image {
            background-repeat: no-repeat;
        }
        svg {
            width: 10px;
            height: 10px;
        }
        .svg-span {
            line-height: 16px;
        }
        .red {
            color: red;
        }
    </style>
</head>

<body class="gray-bg" style="overflow: auto">
<div class="col-md-12">
    <div class="col-md-6">
        <div style="display: inline-block">CPU<div id="container-num" style="display: inline-block; margin-left: 10px">
            <span class="svg-span"><svg t="1678668628893" class="icon" viewBox="0 0 1024 1024" version="1.1"
                                        xmlns="http://www.w3.org/2000/svg" p-id="9128" width="32" height="32"><path
                    d="M448 1024V244.992l-320 320V384l384-384 384 384v180.992l-320-320V1024z" fill="#52C41A"
                    p-id="9129"></path></svg></span>

            <span class="svg-span">11</span>
        </div></div>
        <div id="container"></div>
    </div>
    <div class="col-md-6">
        <div>内存</div>
        <div id="mem"></div>
    </div>
</div>
<div class="col-md-12">
    <div class="col-md-6">
        <div>磁盘</div>
        <div id="file"></div>
    </div>
    <div class="col-md-6">
        <div>磁盘</div>
        <div class="col-md-12">
            <table class="table table-striped" id="file1"></table>
        </div>
    </div>

</div>
<div class="col-md-12">
    <div class="col-md-12">
        <div>网卡</div>
        <div id="container1"></div>
    </div>
</div>
<div class="col-md-12">
    <div class="col-md-6">
        <div>CPU占用率最高</div>
        <div class="col-md-12">
            <table class="table table-striped" id="exampleTableColumns"></table>
        </div>
    </div>
    <div class="col-md-6">
        <div>内存占用率最高</div>
        <div class="col-md-12">
            <table class="table table-striped" id="exampleTableColumns1"></table>
        </div>
    </div>
</div>

<script>
</script>
<!-- 全局js -->
<script src="{{contentPath}}/resource/js/jquery.min.js?v=2.1.4"></script>
<script src="{{contentPath}}/resource/js/bootstrap.min.js?v=3.3.6"></script>

<!-- 自定义js -->
<script src="{{contentPath}}/resource/js/content.js?v=1.0.0"></script>
<!-- Peity -->
<script src="{{contentPath}}/resource/js/plugins/toastr/toastr.min.js"></script>
<script src="{{contentPath}}/resource/lib/reconnecting-websocket.min.js?v=1.0.0"></script>
<script src="{{contentPath}}/resource/lib/g2plot.min.js" type="text/javascript"></script>
<script> const {Line, Area, Gauge, Column, G2, Pie} = G2Plot;</script>
<script src="{{contentPath}}/resource/js/plugins/bootstrap-table/bootstrap-table.min.js"></script>
<script src="{{contentPath}}/resource/js/plugins/bootstrap-table/locale/bootstrap-table-zh-CN.min.js"></script>
<script src="{{contentPath}}/resource/js/vm-cpu.js" type="text/javascript"></script>
<script src="{{contentPath}}/resource/js/vm-net.js" type="text/javascript"></script>
<script src="{{contentPath}}/resource/js/vm-file.js" type="text/javascript"></script>
<script src="{{contentPath}}/resource/js/vm-mem.js" type="text/javascript"></script>
<script src="{{contentPath}}/resource/js/vm-process.js" type="text/javascript"></script>
<script>

    var wsFuc = undefined;
    if ("WebSocket" in window) {
        wsFuc = function () {
            // 创建一个 websocket
            var ws = new ReconnectingWebSocket('ws://' + window.location.hostname + ":{{ws}}/vm");

            ws.onopen = function () {
            };

            let $containerNum = $('#container-num > span:eq(1)');
            ws.onmessage = function (evt) {
                try {
                    let parse = JSON.parse(evt.data);
                    let type = parse['type'];
                    if ('cpu' == type) {
                        const x = parse['enterTime'], // current time
                            y = parseFloat(parse['ex']);

                        let style = '';
                        if(y > 0.7) {
                            style = 'red';
                        }
                        $containerNum.html(`<span class="${style}">${y}</span>`);
                        if (cpu.options.data.length > 100) {
                            cpu.options.data.shift();
                        }
                        const newData = cpu.options.data.concat({x, y});
                        cpu.changeData(newData);
                        return false;
                    }
                    if ('net' == type) {
                        const x = parse['enterTime'], // current time
                            name = parse['threadName'],
                            y = parseFloat(parse['ex']);

                        if (net.options.data.length > 100) {
                            net.options.data.shift();
                        }
                        const newData = net.options.data.concat({x, y, name});
                        net.changeData(newData);
                        return false;
                    }

                    if ('mem' == type) {
                        let parse1 = JSON.parse(parse['ex']);

                        let data = [];
                        parse1.forEach(it => {
                            data = data.concat({
                                x: it['threadName'],
                                y: parseFloat(it['ex'])
                            })
                        })
                        mem.changeData(data);
                        return false;
                    }

                    if ('file' == type) {
                        let parse1 = JSON.parse(parse['ex']);

                        let data = [];
                        parse1.forEach(it => {
                            data = data.concat({
                                x: it['threadName'],
                                y: parseFloat(it['ex'])
                            })
                        })
                        file.changeData(data);
                        $('#file1').bootstrapTable('load', parse1);
                        // file.changeData((data.map((d) => ({ ...d, value: d.value * Math.random() }))));
                        return false;
                    }
                    if ('process-mem' == type) {
                        let parse1 = JSON.parse(parse['ex']);
                        $('#exampleTableColumns').bootstrapTable('load', parse1);
                        return false;
                    }

                    if ('process-cpu' == type) {
                        let parse1 = JSON.parse(parse['ex']);
                        $('#exampleTableColumns1').bootstrapTable('load', parse1);
                        return false;
                    }
                } catch (e) {
                }
            };

            ws.onclose = function () {
            };
        }
        wsFuc();
    } else {
        document.getElementById('result').innerHTML = '"您的浏览器不支持 WebSocket!"';
    }
</script>
</body>

</html>
